<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signup</title>
    <link rel="stylesheet" href="signup.css">
</head>
<body>
    <a class="navbar-brand" href="index.html" style="color: rgb(1, 1, 5); margin-right: 2000px; font-size: 35px; text-decoration: none; font-weight: bold;">SafeAlert</a>


    
    <h2>Create Your SafeAlert Account</h2>

<div class="signup-container">
  <form id="signupForm">
        <label for="fullname">Full Name</label>
        <input type="text" id="fullname" name="fullname" placeholder="Enter your full name" required>

        <label for="email">Email Address</label>
        <input type="email" id="email" name="email" placeholder="Enter your email" required>

        <label for="password">Password</label>
        <input type="password" id="password" name="password" placeholder="Create a strong password" required>

        <label for="phone">Phone Number</label>
        <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required>

        <label for="address">Address</label>
        <input type="text" id="address" name="address" placeholder="Enter your address" required>

        <label for="usertype">User Type</label>
        <select id="usertype" name="usertype" required>
            <option value="">Select an option</option>
            <option value="citizen">Citizen</option>
            <option value="first_responder">First Responder</option>
            <option value="security">Security Personnel</option>
        </select>

        <label for="profile">Upload Profile Picture</label>
        <input type="file" id="profile" name="profile" accept="image/*">

        <div class="terms">
            <input type="checkbox" id="terms" required>
            <label for="terms">I agree to the <a href="#">Terms & Conditions</a></label>
        </div>

        <button type="submit">Sign Up</button>

        <div class="login-link">
            Already have an account? <a href="login.html">Log in</a>
        </div>
    </form>
    <div id="success-message" style="display:none; color: green;">Sign-up successful!</div>

</div>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCYmCbg9nFHtyuDNetkX2WtEAPh86PB0os",
    authDomain: "safealert-c9876.firebaseapp.com",
    databaseURL: "https://safealert-c9876-default-rtdb.firebaseio.com",
    projectId: "safealert-c9876",
    storageBucket: "safealert-c9876.appspot.com",
    messagingSenderId: "485449780513",
    appId: "1:485449780513:web:3b21e73628ba4400fa8260",
    measurementId: "G-LXWJED63PW"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const database = firebase.database();
  const storage = firebase.storage();
</script>

<script>
document.getElementById("signupForm").addEventListener("submit", function (event) {
  event.preventDefault();

  const fullName = document.getElementById("fullname").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const userType = document.getElementById("usertype").value;
  const profilePicture = document.getElementById("profile").files[0];
  const termsChecked = document.getElementById("terms").checked;

  if (!termsChecked) {
    alert("You must agree to the terms and conditions to proceed.");
    return;
  }

  // Step 1: Create user in Firebase Authentication
  auth.createUserWithEmailAndPassword(email, password)
    .then((userCredential) => {
      const userId = userCredential.user.uid;

      // Step 2: Upload profile picture (if selected)
      if (profilePicture) {
        const storageRef = storage.ref('profilePictures/' + userId + '_' + profilePicture.name);
        storageRef.put(profilePicture).then((snapshot) => {
          snapshot.ref.getDownloadURL().then((url) => {
            saveUserData(userId, fullName, email, phone, address, userType, url);
          }).catch((error) => {
            console.error("Error getting download URL: ", error);
            alert("There was an error saving your profile picture.");
          });
        }).catch((error) => {
          console.error("Error uploading file: ", error);
          alert("There was an error uploading your profile picture.");
        });
      } else {
        saveUserData(userId, fullName, email, phone, address, userType, null);
      }
    })
    .catch((error) => {
      alert("Signup failed: " + error.message);
    });

  // Save user info in Realtime Database
  function saveUserData(userId, fullName, email, phone, address, userType, profileUrl) {
    database.ref('users/' + userId).set({
      fullName: fullName,
      email: email,
      phone: phone,
      address: address,
      userType: userType,
      profilePicture: profileUrl || "none"
    }).then(() => {
      // Show success message
      document.getElementById("signupForm").reset();
      document.getElementById("success-message").style.display = "block";

      // Hide success message after 3 seconds
      setTimeout(() => {
        document.getElementById("success-message").style.display = "none";
      }, 3000);
    }).catch((error) => {
      console.error("Error saving user data: ", error);
      alert("There was an error saving your data.");
    });
  }
});
</script>
    
</body>
</html>